#![no_main]

use bridge::{ExploitInput, ExploitOutput, sim_exploit, DEFAULT_CONTRACT_ADDRESS};
use risc0_zkvm::guest::env;

risc0_zkvm::guest::entry!(main);

pub fn main() {
    let input: ExploitInput = env::read();
    let result_and_state = sim_exploit(&input);
    if !result_and_state.result.is_success() {
        panic!()
    }

    let gas_used = result_and_state.result.gas_used();
    let mut output = ExploitOutput {
        input: input,
        gas_used: gas_used,
        state: result_and_state.state,
    };
    let poc_contract_info = output.input.db.accounts.get_mut(&DEFAULT_CONTRACT_ADDRESS).unwrap();
    poc_contract_info.info.code = None;

    env::commit(&output);
    core::mem::forget(output);
}